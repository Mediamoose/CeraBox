/**
 * @package     CeraBox
 *
 * @author      Sven
 * @since       13-01-2011
 * @version     1.3.4
 *
 * This package requires
 * - MooTools 1.4 >
 * - MooTools More Assets
 *
 * @license The MIT License
 *
 * Copyright (c) 2011-2012 Ceramedia, <http://ceramedia.net/>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
var CeraBox=CeraBox||new Class({version:"1.3.4",Implements:[Options],boxWindow:null,collection:[],currentItem:0,options:{ajax:null,group:true,width:null,height:null,displayTitle:true,fullSize:false,displayOverlay:true,clickToClose:false,loaderAtItem:false,animation:"fade",errorLoadingMessage:"The requested content cannot be loaded or might not be supported. Please try again later.",titleFormat:"Item {number} / {total} {title}",addContentProtectionLayer:false,mobileView:Browser.Platform.ios||Browser.Platform.android||Browser.Platform.webos,fixedPosition:false,clickToCloseOverlay:true,events:{onOpen:function(a,b){},onChange:function(a,b){},onClose:function(a,b){},onAnimationEnd:function(a,b){}}},initialize:function(a,b){this.boxWindow=CeraBoxWindow;a=$$(a);if(b&&typeOf(b.group)!="null"&&b.group===false&&a.length>1){a.each(function(c){c.store("cerabox",new CeraBox(c,b))})}this.setOptions(b);a.each(function(e,c){this.collection[c]=e;var d=e.dataset?(typeOf(e.dataset.type)=="string"&&e.dataset.type.trim()!=""?e.dataset.type.trim():null):(e.get("data-type")&&e.get("data-type").trim()!=""?e.get("data-type").trim():null);if((null!==this.options.ajax&&d===null)||d=="ajax"){e.addEvent("click",function(f){if(this._itemClick(f)){this.currentItem=c;this.showAjax();return true}return false}.bind(this))}else{if((e.get("href").test(/^#/i)&&d===null)||d=="inline"){e.addEvent("click",function(f){if(this._itemClick(f)){this.currentItem=c;this.showInline();return true}return false}.bind(this))}else{if((e.get("href").test(/\.(jpg|jpeg|png|gif|bmp)(.*)?$/i)&&d===null)||d=="image"){e.addEvent("click",function(f){if(this._itemClick(f)){this.currentItem=c;this.showImage();return true}return false}.bind(this))}else{if((e.get("href").test(/\.(swf)(.*)?$/i)&&d===null)||d=="swf"){e.addEvent("click",function(f){if(this._itemClick(f)){this.currentItem=c;this.showSwf();return true}return false}.bind(this))}else{if(d!==null&&d!="iframe"){throw"Unknown type in dataset: "+d}e.addEvent("click",function(f){if(this._itemClick(f)){this.currentItem=c;this.showIframe();return true}return false}.bind(this))}}}}}.bind(this))},showAjax:function(){var ceraBox=this,currentItem=ceraBox.collection[ceraBox.currentItem],requestEr=new Request.HTML({url:currentItem.get("href"),method:ceraBox.options.ajax.method?ceraBox.options.ajax.method:"post",data:ceraBox.options.ajax.data?ceraBox.options.ajax.data:"",evalScripts:ceraBox.options.ajax.evalScripts?ceraBox.options.ajax.evalScripts:false,onSuccess:function(responseTree,responseElements,responseHTML,responseJavaScript){if(false===ceraBox.boxWindow.getBusy()){return}var assets=[];Array.each(responseElements,function(ele){if(ele.get("tag")=="img"&&ele.get("src")){assets.append([ele.get("src")])}});var assetsLoaded=function(){var ajaxEle=ceraBox.boxWindow.preLoadElement(responseTree);ajaxEle.setStyle("width",ceraBox.options.width?ceraBox.options.width:ajaxEle.getScrollSize().x+"px");ajaxEle.setStyle("height",ceraBox.options.height?ceraBox.options.height:ajaxEle.getScrollSize().y+"px");var dimension=ceraBox.boxWindow.getSizeElement(ajaxEle);ajaxEle=ajaxEle.get("html");ceraBox.boxWindow.onLoad(dimension.width,dimension.height).addEvent("complete",function(){this.removeEvents("complete");if(false===ceraBox.boxWindow.getBusy()){return}if(false!==ceraBox.options.displayTitle){ceraBox.boxWindow.displayTitle((currentItem.get("title")?currentItem.get("title"):""),ceraBox.currentItem+1,ceraBox.collection.length)}ceraBox.boxWindow.setContent(new Element("div",{html:ajaxEle})).openWindow();(function(){eval(responseJavaScript)}).call(ceraBox)})};if(assets.length){Asset.images(assets,{onComplete:assetsLoaded})}else{assetsLoaded()}},onerror:ceraBox._timedOut.bind(ceraBox),onTimeout:ceraBox._timedOut.bind(ceraBox),onFailure:ceraBox._timedOut.bind(ceraBox),onException:ceraBox._timedOut.bind(ceraBox)}).send()},showInline:function(){var d=this,c=d.collection[d.currentItem],e=(c.get("href").test(/^#\$/i)&&typeOf(window[c.get("href").replace(/^#\$/i,"")])!="null")?((typeOf(window[c.get("href").replace(/^#\$/i,"")])!="element")?new Element("div",{html:window[c.get("href").replace(/^#\$/i,"")]}):window[c.get("href").replace(/^#\$/i,"")]):(document.id(document.body).getElement(c.get("href"))?document.id(document.body).getElement(c.get("href")).clone():null);if(null!==e){var b=[];Array.each(e.getElements("img"),function(f){if(f.get("src")){b.append([f.get("src")])}});var a=function(){var f=d.boxWindow.preLoadElement(e.clone());f.setStyle("width",d.options.width?d.options.width:f.getScrollSize().x+"px");f.setStyle("height",d.options.height?d.options.height:f.getSize().y+"px");var g=d.boxWindow.getSizeElement(f);d.boxWindow.onLoad(g.width,g.height).addEvent("complete",function(){this.removeEvents("complete");if(false===d.boxWindow.getBusy()){return}if(false!==d.options.displayTitle){d.boxWindow.displayTitle((c.get("title")?c.get("title"):""),d.currentItem+1,d.collection.length)}d.boxWindow.setContent(e).openWindow()})};if(b.length){Asset.images(b,{onComplete:a})}else{a()}}else{d._timedOut()}},showImage:function(){var b=this,a=b.collection[b.currentItem],c=new Asset.image(a.get("href"),{"class":"image",onload:function(){if(false===b.boxWindow.getBusy()){return}this.set("width",b.options.width?b.options.width:this.get("width"));this.set("height",b.options.height?b.options.height:this.get("height"));var d=b.boxWindow.getSizeElement(this);b.boxWindow.onLoad(d.width,d.height).addEvent("complete",function(){this.removeEvents("complete");if(false===b.boxWindow.getBusy()){return}if(false!==b.options.displayTitle){b.boxWindow.displayTitle((a.get("title")?a.get("title"):""),b.currentItem+1,b.collection.length)}b.boxWindow.setContent(c).openWindow()})},onerror:b._timedOut.bind(b)})},showSwf:function(){if(Browser.Plugins.Flash.version==0){this._timedOut();return}var c=this,b=c.collection[c.currentItem],d={width:c.options.width?c.options.width:500,height:c.options.height?c.options.height:400},a=new Swiff(b.get("href"),{width:d.width,height:d.height,params:{wMode:"opaque"}});c.boxWindow.onLoad(d.width,d.height).addEvent("complete",function(){this.removeEvents("complete");if(false===c.boxWindow.getBusy()){return}if(false!==c.options.displayTitle){c.boxWindow.displayTitle((b.get("title")?b.get("title"):""),c.currentItem+1,c.collection.length)}c.boxWindow.setContent(a).openWindow()})},showIframe:function(){this.boxWindow.setTimeOuter(this._timedOut.delay(10000,this));var c=this,b=c.collection[c.currentItem],a=new IFrame({src:b.get("href"),"class":"iframe",styles:{width:1,height:1,border:"0px"},events:{load:function(){if(false===c.boxWindow.getBusy()&&!c.boxWindow.getWindowOpen()){return}if(!c.options.width&&!c.options.height){try{if(!Browser.ie||Browser.version>8){this.contentWindow.onbeforeunload=function(){c.boxWindow.loading(c);this.setStyles({width:"1px",height:"1px"})}.bind(this)}else{this.setStyles({width:"1px",height:"1px"})}}catch(d){}}if(c.options.width){this.setStyle("width",c.options.width)}if(c.options.height){this.setStyle("height",c.options.height)}var e=c.boxWindow.getSizeElement(this);c.boxWindow.onLoad(e.width,e.height).addEvent("complete",function(){this.removeEvents("complete");if(false===c.boxWindow.getBusy()&&!c.boxWindow.getWindowOpen()){return}c.boxWindow.openWindow()})}}});a.set("border",0);a.set("frameborder",0);this.boxWindow.setContent(a)},_timedOut:function(){var b=this,a=new Element("span",{"class":"cerabox-error",html:b.options.errorLoadingMessage});var c=b.boxWindow.preLoadElement(a.clone());c.setStyle("width","270px");c.setStyle("height",c.getSize().y+"px");if(this.options.mobileView){a.setStyles({position:"absolute",top:"50%","margin-top":-Math.round(c.getSize().y/2)+"px"})}var d=b.boxWindow.getSizeElement(c,true);b.boxWindow.onLoad(d.width,d.height).addEvent("complete",function(){this.removeEvents("complete");if(false===b.boxWindow.getBusy()){return}b.boxWindow.hideTitle();b.boxWindow.setContent(a).openWindow()})},_itemClick:function(a){if(a){a.preventDefault()}if(this.boxWindow.getBusy()){return false}this.boxWindow.loading(this);return true},_log:function(a,c){try{console.log(a)}catch(b){if(c){alert(a)}}}});var CeraBoxWindow=(function(f){var x=false,A=false,B=null,s=null,l=false,c=null,z={x:0,y:0},t=null,E={x:null,y:null},w={x:null,y:null},v={x:0,y:0},p=null;var d=new Class({initialize:function(){f.addEvent("domready",function(){m();this.updateWindow();document.id("cerabox-loading").addEvent("click",function(F){F.stop();this.close(true)}.bind(this));document.addEvent("keyup",function(F){if(F.key=="esc"){this.close()}if(F.target.get("tag")=="input"||F.target.get("tag")=="select"||F.target.get("tag")=="textarea"){return}if(F.key=="left"){p.getElement(".cerabox-left").fireEvent("click",F)}if(F.key=="right"){p.getElement(".cerabox-right").fireEvent("click",F)}}.bind(this));p.addEvent("touchstart",j);p.addEvent("touchmove",r);p.addEvent("touchend",i);p.addEvent("touchcancel",g);document.id("cerabox-loading").addEvent("touchmove",function(F){F.stop()})}.bind(this));f.addEvent("resize",this.updateWindow.bind(this));f.addEvent("scroll",this.updateWindow.bind(this,"scroll"));f.addEvent("orientationchange",this.updateWindow.bind(this))},updateWindow:function(F){this.setViewport();if(!l||null===c||x||(F=="scroll"&&!c.options.mobileView)){return}x=true;if(false!==c.options.displayOverlay||c.options.mobileView){e()}q().addEvent("complete",function(){this.removeEvents("complete");n();x=false})},close:function(F){if((x&&!F)||A||!c){return}x=!F;clearInterval(s);clearInterval(B);clearInterval(t);document.id("cerabox-loading").setStyle("display","none");if(c.options.mobileView){document.id("cerabox-background").setStyles({display:"none",width:0,height:0,opacity:0});p.setStyles({display:"none"});p.getElement(".cerabox-content").empty().setStyle("opacity",0);p.getElement(".cerabox-left").removeEvents("click").setStyle("display","none");p.getElement(".cerabox-right").removeEvents("click").setStyle("display","none");this.hideTitle();if(l){c.options.events.onClose.call(c,c.collection[c.currentItem],c.collection)}c=null;l=false;x=false}else{p.set("tween",{duration:50}).tween("opacity",0).get("tween").addEvent("complete",function(){this.removeEvents("complete");document.id("cerabox-background").set("tween",{duration:50,link:"chain"}).tween("opacity",0).get("tween").addEvent("chainComplete",function(){this.removeEvents("chainComplete");document.id("cerabox-background").setStyle("display","none");p.setStyles({display:"none"});p.getElement(".cerabox-content").empty().setStyle("opacity",0);p.getElement(".cerabox-left").removeEvents("click").setStyle("display","none");p.getElement(".cerabox-right").removeEvents("click").setStyle("display","none");a.hideTitle();if(l){c.options.events.onClose.call(c,c.collection[c.currentItem],c.collection)}c=null;l=false;x=false})})}},setContent:function(F){p.getElement(".cerabox-content").empty().adopt(F);return this},loading:function(F){if(!instanceOf(F,CeraBox)){throw"Instance should be an instance of CeraBox"}this.setViewport();c=F;x=true;p.getElement(".cerabox-content-protection").setStyle("display","none");if(true===c.options.addContentProtectionLayer){p.getElement(".cerabox-content-protection").setStyle("display","block")}p.setStyle("cursor","auto").removeEvents("click");if(true===c.options.clickToClose){p.setStyle("cursor","pointer").addEvent("click",function(G){G.stop();this.close()}.bind(this))}clearInterval(s);clearInterval(B);document.id("cerabox-loading").setStyle("display","none");B=k.delay(200);p.removeClass("mobile");if(c.options.mobileView){p.addClass("mobile")}return this},preLoadElement:function(F){p.setStyle("display","block");return p.getElement("#cerabox-ajaxPreLoader").empty().adopt(F)},onLoad:function(F,G){A=true;clearInterval(s);clearInterval(B);if(false!==c.options.displayOverlay||c.options.mobileView){e()}p.getElement("#cerabox-ajaxPreLoader").empty().setStyles({width:"auto",height:"auto"});z={x:F,y:G};return p.getElement(".cerabox-content").set("tween",{duration:c.options.mobileView?0:300}).tween("opacity",(l&&p.getElement(".cerabox-content iframe")?1:0)).get("tween")},openWindow:function(G,H){document.id("cerabox-loading").setStyle("display","none");G=z.x=G||z.x;H=z.y=H||z.y;var F=c.collection[c.currentItem];n();if(l){q(G,H);if(c.options.mobileView){p.getElement(".cerabox-content").setStyle("opacity",1);A=false;x=false;b();c.options.events.onChange.call(c,F,c.collection)}else{p.getElement(".cerabox-content").set("tween",{duration:p.getElement(".cerabox-content iframe")?0:200}).tween("opacity",1).get("tween").addEvent("complete",function(){this.removeEvents("complete");A=false;x=false;b();c.options.events.onChange.call(c,F,c.collection)})}return}if(!c.options.mobileView){p.getElement(".cerabox-content").setStyle("opacity",1)}c.options.events.onOpen.call(c,F,c.collection);q(G,H).addEvent("complete",function(){this.removeEvents("complete");if(c.options.mobileView){p.getElement(".cerabox-content").setStyle("opacity",1)}A=false;x=false;b();c.options.events.onAnimationEnd.call(c,F,c.collection)});F.blur();l=true},displayTitle:function(H,F,G){if(G>1){H=c.options.titleFormat.substitute({number:F,total:G,title:H})}if(H){p.getElement(".cerabox-title span").setStyle("display","block").set("text",H)}else{p.getElement(".cerabox-title span").setStyle("display","block")}return this},hideTitle:function(){p.getElement(".cerabox-title span").setStyle("display","none");return this},setViewport:function(){v={x:(f.innerWidth?f.innerWidth:f.getSize().x),y:(f.innerHeight?f.innerHeight:f.getSize().y)};return this},getViewport:function(){return v},getCurrentInstance:function(){return c},getBusy:function(){return x},getWindowOpen:function(){return l},setTimeOuter:function(F){s=F;return this},getSizeElement:function(G,F){var H=0,K=0;if(G.get("tag")=="iframe"){p.setStyle("display","block");try{H=(G.get("width")?C(G.get("width"),"x"):(G.getStyle("width").toInt()>1?C(G.getStyle("width"),"x"):(G.contentWindow.document.getScrollSize().x?G.contentWindow.document.getScrollSize().x:v.x*0.75)))}catch(J){H=v.x*0.75}try{K=(G.get("height")?C(G.get("height"),"y"):(G.getStyle("height").toInt()>1?C(G.getStyle("height"),"y"):(G.contentWindow.document.getScrollSize().y?G.contentWindow.document.getScrollSize().y:v.y*0.75)))}catch(J){K=v.y*0.75}if(Browser.ie){K=K+20}if(!F&&false===c.options.fullSize){if((v.y-100)<K){H=H+(Browser.Platform.mac?15:17)}return{width:(v.x-50)<H?(v.x-50):H,height:(v.y-100)<K?(v.y-100):K}}else{return{width:H,height:K}}}H=(G.get("width")?C(G.get("width"),"x"):(G.getStyle("width")&&G.getStyle("width")!="auto"?C(G.getStyle("width"),"x"):v.x-50));K=(G.get("height")?C(G.get("height"),"y"):(G.getStyle("height")&&G.getStyle("height")!="auto"?C(G.getStyle("height"),"y"):v.y-100));if(!F&&false===c.options.fullSize){var I=Math.min(Math.min(v.x-50,H)/H,Math.min(v.y-100,K)/K);return{width:Math.round(I*H),height:Math.round(I*K)}}else{return{width:H,height:K}}}}),a=new d();function b(){p.getElement(".cerabox-left").removeEvents("click").setStyle("display","none");p.getElement(".cerabox-right").removeEvents("click").setStyle("display","none");if(c.collection[c.currentItem-1]){p.getElement(".cerabox-left").setStyle("display","block").addEvent("click",function(F){F.stopPropagation();if(!x){this.setStyle("display","none").removeEvents("click");c.collection[c.currentItem-1].fireEvent("click",F)}})}if(c.collection[c.currentItem+1]){p.getElement(".cerabox-right").setStyle("display","block").addEvent("click",function(F){F.stopPropagation();if(!x){this.setStyle("display","none").removeEvents("click");c.collection[c.currentItem+1].fireEvent("click",F)}})}}function q(F,O){F=F||z.x;O=O||z.y;if(!c.options.displayTitle||p.getElement(".cerabox-content iframe")){a.hideTitle()}if(c.options.mobileView){document.id(document.body).setStyle("overflow","hidden");var J=Math.abs(f.orientation)==90,M=J?screen.height:screen.width,G,L,H,I;if(p.getElement(".cerabox-content iframe")){G=v.x,L=v.y,H=(L<(O*G/F)?L/O:G/F),I=1;p.getElements(".cerabox-close, .cerabox-left, .cerabox-right, .cerabox-title").setStyles({"-webkit-transform":"scale("+(v.x/M)+")",transform:"scale("+(v.x/M)+")"})}else{if(!p.getElement(".cerabox-content img")){F=Math.round(v.x*(M/v.x));O=Math.round(v.y*(M/v.x))}G=Math.round(v.x*(M/v.x)),L=Math.round(v.y*(M/v.x)),H=(L<(O*G/F)?L/O:G/F),I=(v.x/M);p.getElements(".cerabox-close, .cerabox-left, .cerabox-right, .cerabox-title").setStyles({"-webkit-transform":"scale(1)",transform:"scale(1)"})}p.setStyles({position:"absolute",display:"block",width:G+"px",height:L+"px",opacity:1,left:document.id(document.body).getScroll().x,right:0,top:document.id(document.body).getScroll().y,bottom:0,margin:0,"-webkit-transform":"scale("+(I)+")",transform:"scale("+(I)+")"});p.getElement(".cerabox-content").setStyles({width:Math.round(F*H),height:Math.round(O*H),left:((G-Math.round(F*H))/2),top:((L-Math.round(O*H))/2)});if(p.getElement(".cerabox-content iframe")){p.getElement(".cerabox-content iframe").setStyles({width:Math.round(F*H),height:Math.round(O*H)})}return p.set("tween",{duration:0}).tween("opacity",1).get("tween")}else{if(p.getElement(".cerabox-content iframe")){p.getElement(".cerabox-content iframe").setStyles({width:F,height:O})}var K={display:"block",width:F,height:O,opacity:1,"-webkit-transform":"scale(1)",transform:"scale(1)"};p.setStyles({position:(c.options.fixedPosition?"fixed":"absolute"),top:Math.round((v.y/2))+"px",left:Math.round((v.x/2))+"px",right:"auto",bottom:"auto"});if(v.x>F+60){K["margin-left"]=Math.round((-F/2)+(!c.options.fixedPosition?document.id(document.body).getScroll().x:0))+"px"}else{K["margin-left"]=Math.round(((v.x/2)-F-40)+(!c.options.fixedPosition?document.id(document.body).getScroll().x:0))+"px"}if(v.y>O+40){K["margin-top"]=Math.round((-O/2)+(!c.options.fixedPosition?document.id(document.body).getScroll().y:0))+"px"}else{K["margin-top"]=Math.round((-v.y/2+20)+(!c.options.fixedPosition?document.id(document.body).getScroll().y:0))+"px"}p.getElement(".cerabox-content").setStyles({width:"100%",height:"100%",left:0,top:0});if(!l){switch(c.options.animation){case"ease":var N=c.collection[c.currentItem];Object.append(K,{top:p.getStyle("top"),left:p.getStyle("left")});return p.setStyles({display:"block",left:(N.getPosition().x-(c.options.fixedPosition?document.id(document.body).getScroll().x:0))+"px",top:(N.getPosition().y-(c.options.fixedPosition?document.id(document.body).getScroll().y:0))+"px",width:N.getSize().x+"px",height:N.getSize().y+"px",margin:0,opacity:0}).set("morph",{duration:200}).morph(K).get("morph");break;case"fade":default:Object.append(K,{opacity:0});return p.setStyles(K).set("tween",{duration:200}).tween("opacity",1).get("tween");break}}else{return p.set("morph",{duration:150}).morph(K).get("morph")}}}function e(){var F={display:"block",opacity:c.options.mobileView?1:0.5,top:0,left:0,height:"100%",width:"100%",position:"fixed"};if(c.options.mobileView){Object.merge(F,{top:0,left:0,width:(document.id(document.body).getScrollSize().x)+"px",height:(document.id(document.body).getScrollSize().y)+"px",position:"absolute"})}document.id("cerabox-background").setStyles(F)}function k(){var G={position:"fixed",display:"block",top:"50%",left:"50%","margin-top":"-20px","margin-left":"-20px","-webkit-transform":"scale(1)",transform:"scale(1)"};if(true===c.options.loaderAtItem&&!l){var H=c.collection[c.currentItem];Object.append(G,{position:"absolute",top:Math.round(((H.getSize().y/2)-(document.id("cerabox-loading").getStyle("height").toInt()/2))+H.getPosition().y)+"px",left:Math.round(((H.getSize().x/2)-(document.id("cerabox-loading").getStyle("width").toInt()/2))+H.getPosition().x)+"px","margin-top":0,"margin-left":0})}else{if(c.options.mobileView){var I=Math.abs(f.orientation)==90,F=I?screen.height:screen.width;Object.append(G,{position:"absolute",top:Math.round(((v.y/2)-(document.id("cerabox-loading").getStyle("height").toInt()/2))+document.id(document.body).getScroll().y)+"px",left:Math.round(((v.x/2)-(document.id("cerabox-loading").getStyle("width").toInt()/2))+document.id(document.body).getScroll().x)+"px","margin-top":0,"margin-left":0,"-webkit-transform":"scale("+(v.x/F)+")",transform:"scale("+(v.x/F)+")"})}}document.id("cerabox-loading").setStyles(G);D()}function D(F){if(!F){F=0}document.id("cerabox-loading").getElement("div").setStyle("top",(F*-40)+"px");F=(F+1)%12;if(document.id("cerabox-loading").getStyle("display")!="none"){D.delay(60,this,F)}}function C(F,G){return(typeOf(F)=="string"&&F.test("%")?v[G]*(F.toInt()/100):F.toInt())}function m(){var F=document.id(document.body);if(!F.getElement("#cerabox")){F.adopt([new Element("div",{id:"cerabox-loading"}).adopt(new Element("div")),new Element("div",{id:"cerabox-background",events:{click:function(G){G.stop();if(c.options.clickToCloseOverlay){a.close()}}}}),p=new Element("div",{id:"cerabox"}).adopt([new Element("div",{"class":"cerabox-content"}),new Element("div",{"class":"cerabox-title"}).adopt(new Element("span")),new Element("a",{"class":"cerabox-close",events:{click:function(G){G.stop();a.close()}}}),new Element("a",{"class":"cerabox-left"}).adopt(new Element("span")),new Element("a",{"class":"cerabox-right"}).adopt(new Element("span")),new Element("div",{"class":"cerabox-content-protection"}),new Element("div",{id:"cerabox-ajaxPreLoader",styles:{"float":"left",overflow:"hidden",display:"block"}})])])}}function y(){clearInterval(t);p.getElements(".cerabox-title, .cerabox-close, .cerabox-left, .cerabox-right").set("tween",{duration:500}).tween("opacity",0)}function n(){p.getElements(".cerabox-title, .cerabox-close, .cerabox-left, .cerabox-right").setStyle("opacity",1);clearInterval(t);if(c.options.mobileView&&!c.options.clickToClose&&"createTouch" in document&&!p.getElement(".cerabox-content iframe")){t=y.delay(5000)}}function j(F){E=w=F.client}function r(F){w=F.client;F.preventDefault()}function i(G){if(null!==E.x&&null!==w.x){var I=h(),H=Math.abs(f.orientation)==90,F=H?screen.height:screen.width;if(50<=Math.round(I*(F/v.x))){u(G,o())}else{if(!I){if(G.target.get("tag")!="a"&&!G.target.getParent(".cerabox-close")&&!G.target.getParent(".cerabox-left")&&!G.target.getParent(".cerabox-right")){p.fireEvent("click",G);G.stop();if(p.getElement(".cerabox-close").getStyle("opacity")!=1){n()}else{y()}}}g()}}else{g()}}function g(){E={x:null,y:null};w={x:null,y:null}}function h(){return Math.round(Math.sqrt(Math.pow(w.x-E.x,2)+Math.pow(w.y-E.y,2)))}function o(){var F=E.x-w.x;var H=w.y-E.y;var G=Math.round(Math.atan2(H,F)*180/Math.PI);if(G<0){G=360-Math.abs(G)}return G}function u(F,G){if(G>=315||G<=45){p.getElement(".cerabox-right").fireEvent("click",F)}else{if(G>=135&&G<=225){p.getElement(".cerabox-left").fireEvent("click",F)}}g()}return a})(window);Array.implement({cerabox:function(a){if(!a||typeOf(a.group)=="null"||a.group===true){var b=new CeraBox(this,a);this.each(function(c){c.store("cerabox",b)})}else{this.each(function(c){c.store("cerabox",new CeraBox(c,a))})}return this}});Element.implement({cerabox:function(a){return this.store("cerabox",new CeraBox(this,a))}});